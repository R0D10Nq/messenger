### Functional Requirements

1. Регистрация и авторизация — email/пароль, восстановление пароля, подтверждение по email; показ текущих сессий и возможность выйти с других устройств.
2. Профиль пользователя — имя, аватар, статус (короткое сообщение), возможность редактировать публичные данные.
3. Контактная книга — добавление контактов по имени/телефону/скану QR, синхронизация контактов (по согласию).
4. Одно-к-одному чат (текст) — отправка/приём сообщений, вложений и emoji.
5. Групповые чаты — создание, приглашения по ссылке, приватные и публичные группы.
6. Отправка файлов и медиа — фотографии, видео, документы; предпросмотр изображений/видео, прогресс загрузки и докачка.
7. Голосовые сообщения — запись в клиенте, отправка и проигрывание внутри чата.
8. Автоматическая расшифровка голосовых сообщений в текст (transcript) — показывается под сообщением с возможностью редактировать расшифровку.
9. Уведомления и пуши — push-уведомления (мобильные/браузер), глубокие ссылки на конкретные сообщения/чаты.
10. Оффлайн режим и синхронизация — локальный кеш, очередь сообщений в оффлайне, корректная синхронизация при восстановлении сети.
11. Статусы доставки — отправлено / доставлено / прочитано; индикация набора текста (typing).
12. Поиск по сообщениям и медиа — фильтрация по дате, отправителю, типу вложения, полнотекстовый поиск.
13. Редактирование и удаление сообщений — возможность править собственные сообщения (лог правок при необходимости) и удалять.
14. Ответ (reply), цитирование и пересылка сообщений — удобно в потоках и при оффлайн-синхроне.
15. Реакции на сообщения — лайк/эмодзи-реакции (в т.ч. множественные).
16. Закрепление сообщений (pin) и избранное (bookmark) в чате.
17. Ментions и ссылочные превью — @упоминания, превью ссылок (title/description/image).
18. Потоки/треды внутри чата — ответная логика для долгих обсуждений.
19. Уровни приватности чатов — таймеры самоудаления (ephemeral messages), режим «секретный чат» с усиленной защитой.
20. Блокировка/жалобы на пользователей и модерация — блокировать контакт, сообщить о нарушении, набор действий для модераторов.
21. Управление группой — роли (владелец, админ, участник), приглашения, модерация, ограничение репостов.
22. Поддержка мультимедийных стикеров/гифок/эмодзи — поиск и набор популярных реакций.
23. Аудио/видео-звонки (1:1 и групповые) — старт/принятие вызова, показ статуса соединения, mute/video off, индикация качества.
24. Демо/превью ссылки для приглашённых (invite preview) — просмотр части переписки по ссылке (по настройке).
25. Мульти-устройства (multidevice) — синхронизация истории между устройствами, привязка новых устройств по подтверждению.
26. Перенос/экспорт переписок — экспорт отдельных чатов в JSON/ZIP (с мультимедиа) по запросу.
27. Настройки приватности и безопасности — управление видимостью профиля, last seen, управление push. **Мессенджер должен быть сложно взломать** — явная пользовательская настройка 2FA/passkeys, управление активными сессиями.
28. Двухфакторная аутентификация и поддержка passkeys (WebAuthn) — как опциональная сильная защита.
29. Защита контента и права доступа — разграничение доступа к вложениям, удалённый доступ/ревока ключей в случае компрометации.
30. Инструменты для работы с большими группами/каналами — рассылка, закрепы, статистика просмотров.
31. Автоматические ответы / быстрые подсказки — smart replies (локальные или на основе AI) и автозавершение.
32. Субтитры/транскрипция для голос/видео (клиентская опция) — включение/отключение, редактирование.
33. Интеграции / bot-интерфейс — публикация уведомлений из внешних сервисов, webhooks (как пользовательская функция для админов/каналов).
34. Перевод сообщений в реальном времени (опционально) — показать «перевести» рядом с сообщением.
35. Безопасность и прозрачность — страницы и подсказки для пользователя о политике шифрования, хранении данных, экспорте и удалении аккаунта.
36. Доступность — поддержка экранных читалок, приспособления для слабовидящих, большие контрастные режимы.
37. Onboarding и инструкции — первые шаги, подсказки по privacy/security, как сообщать о проблемах.
38. Легковесный режим и экономия данных — режим экономии трафика: низкое качество медиа, отложенная загрузка.
39. Локализация и международизация — поддержка нескольких языков, дата/время в локальном формате.
40. Аналитика использования (для админа/собственника) — базовые метрики (DAU, количество сообщений, размер хранилища) — показывать только агрегированные данные.

---

### Technology Stack Recommendations

*(для каждой подсистемы — **одна** конкретная технология/пакет; выбрано как совместимое и актуальное на момент ответа)*

* Язык: **Python 3.12**. ([Python.org][1])
* Backend framework (API): **FastAPI**. ([FastAPI][2])
* ASGI сервер (production): **Uvicorn** (ASGI server для FastAPI).
* Валидация/схемы: **Pydantic v2**.
* ORM / слой доступа к БД: **SQLAlchemy 2.0**.
* База данных: **PostgreSQL 16**. ([PostgreSQL][3])
* Кеш / брокер сообщений для real-time/pub-sub: **Redis** (pub/sub и как fast cache).
* Realtime (events / presence / typing): **python-socketio** (ASGI/Socket.IO) (интегрируется с FastAPI).
* Хранение медиа: **AWS S3 (S3 API)** — хранение и CDN-дистрибуция через S3+CDN.
* Транскрипция голосовых сообщений: **OpenAI Speech-to-Text (Whisper / next-gen transcribe API)** — готовые модели для стабильной расшифровки (использовать с учётом политики конфиденциальности). ([OpenAI][4])
* Криптография / E2E primitives: **PyNaCl (libsodium bindings)** — для реализации безопасных криптопримитивов (подписей, шифрование). ([PyPI][5])
* Аутентификация / OAuth / OIDC flows: **Authlib** (OAuth2 / OIDC helpers).
* Хеширование паролей: **argon2-cffi** (strong password hashing).
* Frontend framework: **React 18** (использовать последнюю стабильную 18.x). ([React][6])
* Frontend build: **Vite** (быстрая сборка для React).
* State management (client): **Zustand** (легковесный, совместим с React 18).
* CSS / Styling: **Tailwind CSS** (utility-first, совместим с Vite/React).
* UI primitives / accessibility: **Radix UI** (headless accessible primitives).
* E2E / интеграционное тестирование: **Playwright**.
* Unit / компонентное тестирование: **Vitest** (работает с Vite).
* CI/CD: **GitLab CI** (или GitHub Actions — но выбрать одну: GitLab CI, если проект уже в GitLab).
* Мониторинг / логирование: **Sentry** (ошибки / performance).
* Документация API: **OpenAPI (автогенерация FastAPI)** — использовать автогенерацию спецификации. ([FastAPI][7])

> Примечание: перечисленные компоненты выбранны как совместимые друг с другом (FastAPI + Uvicorn + python-socketio + SQLAlchemy + PostgreSQL + Redis; React 18 + Vite + Tailwind). Для расшифровки голосов рекомендую внешний cloud-API (OpenAI Speech-to-Text) или выделенный локальный вариант Whisper/whisper.cpp — но в списке указана облачная опция как основная из-за качества и поддержки. ([OpenAI][4])

---

### Design, UX/UI & Usability Requirements — структурированный чеклист (для дизайнера и верстальщика)

**Общие принципы**

* Современный минималистичный интерфейс; приоритет — читаемость и быстрые действия.
* Эффект «жидкого стекла» (glassmorphism): полупрозрачные панели с размытием фона (backdrop-filter), мягкие тени и отражения; использовать аккуратно, не в ущерб контрастности и доступности.
* Чёткая визуальная иерархия: список чатов — левый столбец/колонка; сообщения — центральная панель; правая панель — информация о чате/профиле.
* Адаптивность: интерфейс должен работать от 320px до 4K; мобильное поведение вынесено отдельно (см. ниже).
* Тёмная и светлая тема; переключатель темы и авто-подстройка по системе.
* Анимации и микровзаимодействия: короткие (<=200ms) микровыравнивающие анимации при открытии чата, отправке сообщения, появлении уведомлений; учитывать prefers-reduced-motion.
* Высокая контрастность текста и достаточный размер шрифтов (минимум 14px body desktop, 16px mobile) — соответствие WCAG AA.

**Компоненты разговора**

* Баблы сообщений: чёткие различия inbound/outbound (цвет/граница); максимальная ширина бабла, переносы текста, отступы.
* Аватарки: круглая, 40×40 в списке чатов, 28×28 в сообщениях; fallback — инициал.
* Вложение медиа: карточка с превью, кнопка «сохранить», время, опция открыть в полноэкранном режиме.
* Голосовое сообщение: компактный плеер в бабле (progress bar, time elapsed/total, play/pause, waveform как опция), кнопка «транскрибировать», текст-транскрипт отображается под плеером, возможность правки.
* Статусы сообщений: маленькие пиктограммы рядом со временем (отправлено, доставлено, прочитано).
* Индикатор набора текста: отображать «Иван печатает…» с микроанимацией трёх точек.
* Реакции: всплывающее окно с эмодзи при удержании / наведении; показывать список реакций с числом.

**Интерфейс списков и навигации**

* Список чатов: поисковая строка сверху, фильтрация (все / непрочитанные / избранное), отображать превью последнего сообщения, время, бейдж непрочитанных.
* Быстрые действия на элементе списка (hover на desktop, swipe на mobile): mute, pin, archive, delete, mark read/unread.
* Экран создания/поиска контактов: авто-предложения, подтверждение перед отправкой приглашения.

**Безопасность и конфиденциальность (UI-фокус)**

* Экран «Безопасность» в настройках: видимые активные сессии (device, last seen, ip), кнопка «выйти со всех устройств», инструкции по 2FA/passkeys.
* Ясные баннеры при включении «секретного режима»/E2E (что это значит для пользователя).
* Модальные подтверждения для чувствительных операций (удаление чата, экспорт данных).

**UX для голосовых/видеофункций**

* Простая кнопка записи голосового сообщения (удержать для записи / тап для старт/стоп) с визуальным таймером и индикатором уровня сигнала.
* При включении расшифровки — сразу показывать «Идёт расшифровка…» и прогресс; после — отобразить текст с кнопкой «Править».
* Звонки: плавающая карточка во время звонка (picture-in-picture), кнопки mute, camera, share screen, end call с крупной красной кнопкой.

**UX для оффлайна и синхронизации**

* Ясные статусы сети (online/offline/syncing), счётчик очереди сообщений при оффлайне.
* При ошибке отправки — показывать кнопку retry и подсказку почему (нет сети / ошибка сервера).

**Аксессибилити / локализация**

* Клавиатурная навигация: фокус на ввод, сообщения; aria-labels для всех интерактивных элементов.
* Поддержка screen readers: semantic HTML, aria-roles, alt-тексты.
* Текстовые метки должны быть переводимы; макеты под локализацию (текст может расширяться).

**Микровзаимодействия и детали**

* Подтверждение отправки мультимедиа: мини-превью перед отправкой + возможность отмены.
* Undo для удаления сообщения (показать Snackbar с «Отменить» в 5–8 секунд).
* Интерактивные подсказки в onboarding: краткие tooltips, walkthrough только при первом запуске.
* Мини-автоматика: «предложенные ответы» под сообщением (3 варианта) и «скрыть подсказки» опция.

**Адаптив (mobile first)**

* Мобильная версия: основной экран — список чатов; при открытии чата — экран переписки на весь экран; жесты: свайп влево/вправо для быстрых действий (настраиваемые).
* Экономия трафика: по умолчанию не загружать видео в оригинальном качестве, загружать по тапу.
